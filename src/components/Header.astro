---
const { whatsapp } = Astro.props
const whatsappLink = `https://wa.me/${whatsapp}?text=${encodeURIComponent("Olá! Gostaria de saber mais sobre seus serviços imobiliários.")}`
const navItems = [
  { label: "Início", href: "#inicio" },
  { label: "Sobre", href: "#sobre" },
  { label: "Serviços", href: "#servicos" },
  { label: "Imóveis", href: "#imoveis" },
  { label: "Depoimentos", href: "#depoimentos" },
  { label: "Contato", href: "#contato" },
]
---

<header id="site-header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
  <div class="container-custom">
    <div class="flex items-center justify-between py-4">
      <a href="#inicio" class="text-xl font-display font-semibold text-foreground tracking-tight">
        Esmael Francelino Corretor de Imóveis
        <span class="text-primary">.</span>
      </a>

      <nav class="hidden lg:flex items-center gap-8">
        {navItems.map((item) => (
          <a class="text-sm font-medium text-muted-foreground hover:text-primary transition-colors" href={item.href}>
            {item.label}
          </a>
        ))}
      </nav>

      <div class="hidden lg:flex items-center gap-3">
        <a
          class="btn-primary px-5 py-2.5 text-sm font-semibold inline-flex items-center gap-2"
          href={whatsappLink}
          target="_blank"
          rel="noopener noreferrer"
        >
          <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.86 19.86 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.86 19.86 0 0 1 2.08 4.18 2 2 0 0 1 4.06 2h3a2 2 0 0 1 2 1.72c.12.86.3 1.7.54 2.5a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.58-1.06a2 2 0 0 1 2.11-.45c.8.24 1.64.42 2.5.54A2 2 0 0 1 22 16.92Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Falar Agora</span>
        </a>
      </div>

      <button id="mobile-btn" class="lg:hidden p-2 rounded-lg border border-border/50 bg-card/50 backdrop-blur" aria-label="Abrir menu">
        <svg id="icon-menu" class="h-6 w-6 text-foreground" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <svg id="icon-x" class="hidden h-6 w-6 text-foreground" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M18 6 6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <div id="mobile-menu" class="hidden lg:hidden pb-4">
      <div class="bg-card border border-border/50 rounded-xl p-4">
        <div class="flex flex-col gap-3">
          {navItems.map((item) => (
            <a class="text-sm font-medium text-muted-foreground hover:text-primary transition-colors" href={item.href}>
              {item.label}
            </a>
          ))}
          <a class="btn-primary mt-2 px-5 py-2.5 text-sm font-semibold inline-flex items-center justify-center gap-2" href={whatsappLink} target="_blank" rel="noopener noreferrer">
            <span>Falar no WhatsApp</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  const header = document.getElementById("site-header");
  const btn = document.getElementById("mobile-btn");
  const menu = document.getElementById("mobile-menu");
  const iconMenu = document.getElementById("icon-menu");
  const iconX = document.getElementById("icon-x");

  const setScrolled = () => {
    if (!header) return;
    const scrolled = window.scrollY > 50;
    header.classList.toggle("bg-background/70", scrolled);
    header.classList.toggle("backdrop-blur", scrolled);
    header.classList.toggle("border-b", scrolled);
    header.classList.toggle("border-border/50", scrolled);
  };

  window.addEventListener("scroll", setScrolled, { passive: true });
  setScrolled();

  btn?.addEventListener("click", () => {
    const open = !menu?.classList.contains("hidden");
    menu?.classList.toggle("hidden");
    iconMenu?.classList.toggle("hidden");
    iconX?.classList.toggle("hidden");
    btn?.setAttribute("aria-label", open ? "Abrir menu" : "Fechar menu");
  });

  menu?.querySelectorAll("a[href^='#']")?.forEach((a) => {
    a.addEventListener("click", () => {
      menu.classList.add("hidden");
      iconMenu?.classList.remove("hidden");
      iconX?.classList.add("hidden");
    });
  });
</script>
